<!DOCTYPE html>

<html lang="en">
<head>
	<meta charset="utf-8">

	<title>Cohort Web Test</title>

	<meta name="description" content="">

  <!-- Mobile-friendly viewport -->
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<script type="text/javascript">

	var audio = document.createElement('audio');
	audio.src = 'media/corners.mp3';

	var audioScoreTwo = document.createElement('audio2');
	audioScoreTwo.src = 'media/simpleflux.mp3';

	var audioScoreThree = document.createElement('audio3');
	audioScoreThree.src = 'media/chipmelt.mp3';

	var audioScoreFour = document.createElement('audio4');
	audioScoreFour.src = 'media/ship.mp3';

	var audioScoreFive = document.createElement('audio5');
	audioScoreFive.src = 'media/simpleflux.mp3';

	var audioScoreSix = document.createElement('audio6');
	audioScoreSix.src = 'media/simpleflux.mp3';



	var load = function(){
		audio.load();
		console.log("audio loaded")
	}

		source = new EventSource("/listen");

		source.addEventListener('open', function(e) {
  			console.log("opened sse connection");
		}, false);

		source.addEventListener('error', function(e) {
  			if (e.readyState == EventSource.CLOSED) {
    			console.log("closed sse connection");
  			}
		}, false);

		source.addEventListener('message', function(e) {
// audio.play();
			console.log("received sse");
			console.log(data);
  			// var data = JSON.parse(e.data);
  			// console.log(data.id, data.msg);
		}, false);

		source.addEventListener('cohortMessage', function(e) {

// var x = MessageEvent.data['"action"'];
// 			switch(x){
// 	      case "episode-1-go": audio.play();
// 	      break;
//
// 	      case "episode-2-go": audioScoreTwo.play();
// 	      break;
//
// 	      case "episode-3-go": audioScoreThree.play();
// 	      break;
//
// 	      case "episode-4-go": audioScoreFour.play();
// 	      break;
//
// 	      case "episode-5-go": audioScoreFive.play();
// 	      break;
//
// 	      case "episode-6-go": audioScoreSix.play();
// 	      break;
//
// 	      default: console.log("no music");
// 	    }

			console.log("received SSE");
			console.log(e);
  			var data = JSON.parse(e.data);
  			console.log(data.id, data.msg);
		}, false);

	</script>

</head>
<body>
	<main role="main">
		<h1>Cohort Web Test</h1>
		<button id = "b1" onclick="load()"> GO! </button>
    </main>
</body>
</html>
